<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>üíñ –í–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞</title>
<meta name="theme-color" content="#ff4d88">
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<style>
* { -webkit-tap-highlight-color: transparent; }

body {
    margin: 0;
    height: 100vh;
    background: linear-gradient(135deg, #ffdde1, #ee9ca7);
    font-family: 'Pacifico', cursive;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
}

.container {
    text-align: center;
    padding: 20px;
    z-index: 2;
}

h1 {
    font-size: clamp(28px, 6vw, 46px);
    color: #b3005e;
    margin-bottom: 20px;
}

img {
    width: min(240px, 70vw);
    margin-bottom: 20px;
    transition: 0.3s;
}

.buttons {
    position: relative;
    height: 130px;
}

button {
    font-size: clamp(18px, 5vw, 24px);
    padding: 14px 34px;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: absolute;
}

#yesBtn {
    background: #ff4d88;
    color: white;
    left: 50%;
    transform: translateX(-120%);
}

#noBtn {
    background: #888;
    color: white;
    left: 50%;
    transform: translateX(20%);
}

.plea {
    margin-top: 15px;
    font-size: clamp(16px, 4vw, 22px);
    color: #7a003c;
}

/* –°–µ—Ä–¥–µ—á–∫–∏ */
.heart {
    position: fixed;
    top: -10px;
    animation: fall linear forwards;
    z-index: 1;
    pointer-events: none;
}

@keyframes fall {
    to {
        transform: translateY(110vh);
        opacity: 0;
    }
}
</style>
</head>
<body>

<!-- üéµ –§–û–ù–û–í–ê–Ø –ú–£–ó–´–ö–ê -->
<audio id="bgMusic" loop>
    <source src="nervy_-_slishkom-vlyublen.mp3" type="audio/mpeg">
</audio>

<div class="container">
    <h1 id="question"></h1>

    <img id="gif" src="https://media.giphy.com/media/26BRv0ThflsHCqDrG/giphy.gif">

    <div class="buttons">
        <button id="yesBtn">–î–∞ üíñ</button>
        <button id="noBtn">–ù–µ—Ç üíî</button>
    </div>

    <div class="plea" id="pleaText"></div>
</div>

<script>
/* ‚úèÔ∏è –ò–ú–Ø */
const name = "–°–æ–ª–Ω—ã—à–∫–æ";

/* üîê –°–ï–ö–†–ï–¢–ù–´–ô –ö–õ–Æ–ß */
const SECRET_KEY = "9f3KxL-love";
const urlKey =
  new URLSearchParams(window.location.search).get("key") ||
  new URLSearchParams(window.location.search).get("startapp");

if (urlKey !== SECRET_KEY) {
  document.body.innerHTML = "<h1 style='text-align:center;margin-top:40vh'>üíî –î–æ—Å—Ç—É–ø –∑–∞–∫—Ä—ã—Ç</h1>";
  throw new Error("No access");
}

/* üéµ –ú–£–ó–´–ö–ê */
const music = document.getElementById("bgMusic");

function startMusic() {
    music.volume = 0;
    music.play().catch(() => {});
    let v = 0;
    const fade = setInterval(() => {
        v += 0.02;
        music.volume = Math.min(v, 0.4);
        if (v >= 0.4) clearInterval(fade);
    }, 100);
}

window.addEventListener("load", startMusic);
document.addEventListener("click", startMusic, { once: true });
document.addEventListener("touchstart", startMusic, { once: true });

/* DOM */
const noBtn = document.getElementById('noBtn');
const yesBtn = document.getElementById('yesBtn');
const pleaText = document.getElementById('pleaText');
const gif = document.getElementById('gif');
const question = document.getElementById('question');

question.textContent = `–ë—É–¥–µ—à—å –ª–∏ —Ç—ã –º–æ–µ–π –í–∞–ª–µ–Ω—Ç–∏–Ω–∫–æ–π, ${name}?`;

let noClicks = 0;

/* —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ "–î–∞" */
const savedYes = localStorage.getItem('valentineYes');
if (savedYes) showYesScreen(savedYes);

/* —Ç–µ–∫—Å—Ç—ã –∏ –≥–∏—Ñ–∫–∏ */
const pleas = [
    "–ù—É –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ ü•∫",
    "–¢—ã —É–≤–µ—Ä–µ–Ωa? üò¢",
    "–ú–Ω–µ –±—É–¥–µ—Ç –≥—Ä—É—Å—Ç–Ω–æ üíî",
    "–ü–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å... üò≠"
];

const sadGifs = [
    "https://media.giphy.com/media/ROF8OQvDmxytW/giphy.gif",
    "https://media.giphy.com/media/ISOckXUybVfQ4/giphy.gif",
    "https://media.giphy.com/media/d2lcHJTG5Tscg/giphy.gif",
    "https://media.giphy.com/media/3oriO0OEd9QIDdllqo/giphy.gif"
];

/* –ù–µ—Ç */
noBtn.addEventListener('click', () => {
    if (navigator.vibrate) navigator.vibrate(50);

    if (noClicks < 4) {
        pleaText.textContent = pleas[noClicks];
        gif.src = sadGifs[noClicks];

        yesBtn.style.transform = `translateX(-120%) scale(${1 + noClicks * 0.4})`;
        noBtn.style.transform = `translateX(20%) scale(${1 - noClicks * 0.2})`;

        noClicks++;
    }

    if (noClicks === 4) {
        yesBtn.style.left = "50%";
        yesBtn.style.transform = "translateX(-50%) scale(2)";
        // —Ç–µ–ø–µ—Ä—å –∫–Ω–æ–ø–∫–∞ ¬´–ù–µ—Ç¬ª –±—É–¥–µ—Ç —É–±–µ–≥–∞—Ç—å
    }
});

/* —É–±–µ–≥–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ */
function moveNo() {
    if (noClicks < 4) return; // ‚úÖ —É–±–µ–≥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ 4 –∫–ª–∏–∫–æ–≤
    noBtn.style.left = Math.random() * (window.innerWidth - 100) + 'px';
    noBtn.style.top = Math.random() * (window.innerHeight - 100) + 'px';
}
noBtn.addEventListener('mouseenter', moveNo);
noBtn.addEventListener('touchstart', moveNo);

/* –î–∞ */
yesBtn.addEventListener('click', () => {
    const date = new Date().toLocaleString();
    localStorage.setItem('valentineYes', date);
    showYesScreen(date);
});

function showYesScreen(date) {
    question.textContent = '–Ø –∑–Ω–∞–ª, —á—Ç–æ —Ç—ã —Å–∫–∞–∂–µ—à—å ¬´–¥–∞¬ª üíï';
    pleaText.textContent = `üíñ ${name} —Å–æ–≥–ª–∞—Å–∏–ª–∞—Å—å ${date}`;
    gif.src = "https://media.giphy.com/media/MDJ9IbxxvDUQM/giphy.gif";
    yesBtn.style.display = 'none';
    noBtn.style.display = 'none';
}

/* —Å–µ—Ä–¥–µ—á–∫–∏ */
function createHeart() {
    const heart = document.createElement('div');
    heart.className = 'heart';
    heart.textContent = 'üíñ';
    heart.style.left = Math.random() * 100 + 'vw';
    heart.style.fontSize = (Math.random() * 20 + 15) + 'px';
    heart.style.animationDuration = (Math.random() * 3 + 4) + 's';
    document.body.appendChild(heart);
    setTimeout(() => heart.remove(), 7000);
}
setInterval(createHeart, 300);
</script>

</body>
</html>
